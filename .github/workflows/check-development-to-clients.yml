name: Enforce Merge Policy

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - ldo
      - crv
      - aero
      - uni

jobs:
  check-source-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Validate source branch
        run: |
          SOURCE_BRANCH="${{ github.head_ref }}"
          TARGET_BRANCH="${{ github.base_ref }}"
          ALLOWED_SOURCE="development"
          
          echo "Source branch: $SOURCE_BRANCH"
          echo "Target branch: $TARGET_BRANCH"
          echo "Allowed source: $ALLOWED_SOURCE"
          
          if [ "$SOURCE_BRANCH" != "$ALLOWED_SOURCE" ]; then
            echo "::error::Merge denied. Branch '$TARGET_BRANCH' only accepts merges from branch '$ALLOWED_SOURCE'. Current source: '$SOURCE_BRANCH'"
            exit 1
          fi
          
          echo "✅ Merge allowed: '$SOURCE_BRANCH' → '$TARGET_BRANCH'"
